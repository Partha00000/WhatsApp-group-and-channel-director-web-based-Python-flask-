{% extends "base.html" %}

{% block title %}{{ category.name }} WhatsApp Groups - {{ site_settings.site_name }}{% endblock %}
{% block description %}Find and join {{ category.name }} WhatsApp groups. Connect with people who share your interests in {{ category.name }}.{% endblock %}

{% block content %}
<!-- Category Header -->
<section class="category-header py-5 bg-gradient-primary text-white">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb text-white-50">
                        <li class="breadcrumb-item"><a href="{{ url_for('index') }}" class="text-white-50">Home</a></li>
                        <li class="breadcrumb-item"><span class="text-white-50">Categories</span></li>
                        <li class="breadcrumb-item active text-white">{{ category.name }}</li>
                    </ol>
                </nav>
                <h1 class="display-4 fw-bold mb-3">{{ category.name }}</h1>
                {% if category.description %}
                    <p class="lead mb-0">Discover and join {{ groups.total }} {{ category.name }} WhatsApp groups from around the world.</p>
                {% else %}
                    <p class="lead mb-0">Discover and join {{ groups.total }} {{ category.name }} WhatsApp groups from around the world.</p>
                {% endif %}
            </div>
        </div>
    </div>
</section>

<!-- Groups Section -->
<section class="py-5">
    <div class="container">
        {% if groups.items %}
            <div class="row mb-4">
                <div class="col-md-6">
                    <h2 class="h4 fw-bold">{{ category.name }} Groups</h2>
                    <p class="text-muted">{{ groups.total }} groups found</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setView('grid')" id="gridView">
                            <i class="fas fa-th"></i> Grid
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="setView('list')" id="listView">
                            <i class="fas fa-list"></i> List
                        </button>
                    </div>
                </div>
            </div>

            <div class="row g-4" id="groupsContainer">
                {% for group in groups.items %}
                    <div class="col-lg-4 col-md-6 group-item">
                        <div class="card group-card h-100 shadow-sm">
                            <div class="card-body">
                                <div class="d-flex align-items-start mb-3">
                                    <div class="group-image me-3">
                                        {% if group.image_url %}
                                            <img src="{{ group.image_url }}" alt="{{ group.name }}" class="rounded" width="60" height="60">
                                        {% else %}
                                            <div class="default-group-image d-flex align-items-center justify-content-center rounded">
                                                <i class="fab fa-whatsapp fa-2x text-success"></i>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="flex-grow-1">
                                        <h5 class="card-title mb-1">
                                            <a href="{{ url_for('group_detail', category_slug=group.category_ref.slug, group_slug=group.slug) }}" 
                                               class="text-decoration-none text-dark">
                                                {{ group.name }}
                                            </a>
                                        </h5>
                                        {% if group.featured %}
                                            <span class="badge bg-warning text-dark">
                                                <i class="fas fa-star me-1"></i>Featured
                                            </span>
                                        {% endif %}
                                    </div>
                                </div>

                                {% if group.description %}
                                    <p class="card-text text-muted mb-3">{{ group.description|truncate(120) }}</p>
                                {% endif %}

                                <!-- Group Meta Info -->
                                <div class="group-meta mb-3">
                                    <small class="text-muted d-block mb-1">
                                        <i class="fas fa-globe me-1"></i>
                                        <a href="{{ url_for('country_groups', country_slug=group.country_ref.slug) }}" 
                                           class="text-decoration-none">{{ group.country_ref.name }}</a>
                                    </small>
                                    <small class="text-muted d-block">
                                        <i class="fas fa-language me-1"></i>
                                        <a href="{{ url_for('language_groups', language_slug=group.language_ref.slug) }}" 
                                           class="text-decoration-none">{{ group.language_ref.name }}</a>
                                    </small>
                                </div>

                                <!-- Tags -->
                                {% if group.tags %}
                                    <div class="tags mb-3">
                                        {% for tag in group.tags %}
                                            {% if loop.index <= 3 %}
                                            <a href="{{ url_for('tag_groups', tag_slug=tag.slug) }}" 
                                               class="badge bg-light text-dark text-decoration-none me-1 mb-1">
                                                {{ tag.name }}
                                            </a>
                                            {% endif %}
                                        {% endfor %}
                                        {% if group.tags|length > 3 %}
                                            <span class="badge bg-secondary">+{{ group.tags|length - 3 }} more</span>
                                        {% endif %}
                                    </div>
                                {% endif %}

                                <!-- Action Buttons -->
                                <div class="d-grid gap-2">
                                    <a href="{{ url_for('group_join', invite_code=group.invite_code) }}" 
                                       class="btn btn-whatsapp">
                                        <i class="fab fa-whatsapp me-2"></i>Join Group
                                    </a>
                                    <a href="{{ url_for('group_detail', category_slug=group.category_ref.slug, group_slug=group.slug) }}" 
                                       class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-info-circle me-1"></i>View Details
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Pagination -->
            {% if groups.pages > 1 %}
                <nav aria-label="Category groups pagination" class="mt-5">
                    <ul class="pagination justify-content-center">
                        {% if groups.has_prev %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('category_groups', category_slug=category.slug, page=groups.prev_num) }}">
                                    <i class="fas fa-chevron-left"></i>
                                </a>
                            </li>
                        {% endif %}

                        {% for page_num in groups.iter_pages() %}
                            {% if page_num %}
                                {% if page_num != groups.page %}
                                    <li class="page-item">
                                        <a class="page-link" href="{{ url_for('category_groups', category_slug=category.slug, page=page_num) }}">{{ page_num }}</a>
                                    </li>
                                {% else %}
                                    <li class="page-item active">
                                        <span class="page-link">{{ page_num }}</span>
                                    </li>
                                {% endif %}
                            {% else %}
                                <li class="page-item disabled">
                                    <span class="page-link">â€¦</span>
                                </li>
                            {% endif %}
                        {% endfor %}

                        {% if groups.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="{{ url_for('category_groups', category_slug=category.slug, page=groups.next_num) }}">
                                    <i class="fas fa-chevron-right"></i>
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
            {% endif %}
        {% else %}
            <div class="text-center py-5">
                <div class="empty-state">
                    <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
                    <h3 class="text-muted">No groups found in {{ category.name }}</h3>
                    <p class="text-muted mb-4">Be the first to add a group in this category!</p>
                    <a href="{{ url_for('submit_group') }}" class="btn btn-primary gradient-btn">
                        <i class="fas fa-plus me-2"></i>Add First Group
                    </a>
                </div>
            </div>
        {% endif %}
    </div>
</section>

<!-- Related Categories -->
<section class="py-5 bg-light">
    <div class="container">
        <h2 class="text-center mb-4">Explore Other Categories</h2>
        <div class="row g-3">
            {% for other_category in categories %}
                {% if loop.index <= 8 %}
                {% if other_category.id != category.id %}
                    <div class="col-lg-3 col-md-4 col-sm-6">
                        <a href="{{ url_for('category_groups', category_slug=other_category.slug) }}" 
                           class="card category-card text-decoration-none h-100">
                            <div class="card-body text-center">
                                <h6 class="card-title text-dark">{{ other_category.name }}</h6>
                                <small class="text-muted">{{ other_category.groups|length }} groups</small>
                            </div>
                        </a>
                    </div>
                {% endif %}
                {% endif %}
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
function setView(view) {
    const container = document.getElementById('groupsContainer');
    const gridBtn = document.getElementById('gridView');
    const listBtn = document.getElementById('listView');
    
    if (view === 'list') {
        container.className = 'list-view';
        listBtn.classList.add('active');
        gridBtn.classList.remove('active');
        
        // Update grid items to list items
        document.querySelectorAll('.group-item').forEach(item => {
            item.className = 'col-12 group-item mb-3';
        });
    } else {
        container.className = 'row g-4';
        gridBtn.classList.add('active');
        listBtn.classList.remove('active');
        
        // Update list items to grid items
        document.querySelectorAll('.group-item').forEach(item => {
            item.className = 'col-lg-4 col-md-6 group-item';
        });
    }
    
    // Save preference
    localStorage.setItem('viewPreference', view);
}

// Load saved view preference
document.addEventListener('DOMContentLoaded', function() {
    const savedView = localStorage.getItem('viewPreference') || 'grid';
    setView(savedView);
});
</script>
{% endblock %}
